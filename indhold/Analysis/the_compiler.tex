\chapter{The compiler} \label{chap:the_compiler}
A compiler is a program which translates one language into another. When writing a program, the programmer uses a source language such as Java or C. A computer however only "understands" the language of binary code, the so called machine code. Binary code is in this case the target language reached by translating the source language into the target language, with the use of a compiler. Writing the program in binary code is however not optimal for the programmer as the alphabet of binary consists of 0's and 1's, and is hard to understand for human. So writing a program in a high level language such as Java or C and compiling it into machine code is easier for the programmer.
The goal of this project is to translate a high-level language to another high-level language - namely, from the source language to the Arduino language. The task of translating a programming language into another can be done using a compiler which is, basically, a translator. The compiler allows the programmer to avoid using the target language. The compiler is therefore responsible for always producing a correct representation of source language in the target language.

\section{The structure of a compiler} 
\label{sec:compiler}
Compiling a source language into a target language is not a one step process. The compiler goes through several steps in order to translate a program written in a source language into a program written in the target language. Some steps are necessary, and others are optional.

\begin{itemize}
	\item The first step performed by a compiler is the scanner, which prepares the source code for further treatment. This is done by running through the entire program one character at a time. Any unneeded code, such as the comments, is removed in this process. Every other part of the code is placed in groupings called tokens. These can for example be integers, identifiers and operators. Any user defined elements is furthermore put into a symbol tree, which is accessible throughout the process of compilation. If the user has defined, for example, that whenever the word ``POWER'' is written in the code of the program, it always refers to the number ``9001'', this would be put into the symbol tree. The result is that whenever ``POWER'' is found in the code, it will be replaced with ``9001''. After the source program has been run through, the output from the scanner is passed on to the parser.
	
	\item The second step is the parser, which analyses the syntax of the code received from the scanner. The parser checks if the syntax of the program is compatible to the syntax of the source language. If the written code is not proper according to the source language, it is not possible to be translated correctly. As an example, a C parser will return an error if the code states $a + b = c;$ rather than $c = a + b;$ this is because the syntax of the first expression is illegal in C. It is important to note that at this step it is unknown what the variables contain, which is where the type checker takes over.

	\item After the syntax has been verified, the third step is the type checker, which deals with the semantics of the source code. The type checker verifies that all operations performed in the code are legal with regard to the source language. In the previous example, $c = a + b;$ is syntactically correct. However what has not been specified is the content of a, b and c. If a and b are strings, while c is of the type int, the semantic is incorrect and will therefore return an error as the operation does not exist in the defined source language. If no errors occur, the parser will return an abstract syntax tree (AST) which also concludes the analysis of the source code. As seen in figure \ref{fig:ast_example} the AST shows the syntactic constructs. For example, an assignment requires a variable and an expression. 
	
	\begin{figure}[H]
	\centering
		\includegraphics{billeder/example_ast.png}
		\caption{AST example}
		\label{fig:ast_example}
\end{figure}
	
	

	\item At this point, the preparation of the source code is complete and the translation into the target language can be performed correctly. This is done by the translator. The translator translates the generated AST, from the parser, to an executable form. To translate the AST code generation visitors (CodeGenVisitor) are used, which visit the nodes in the AST. There are various different CodeGenVisitors to generate the right low-level language code. The output from the translator is the compiled product of the source code.
\end{itemize}

While this covers the direct compiling process, more optional steps can be used to enhance the compiling process for different purposes.\\

\begin{itemize}
\item An optimizer can be used to produce more effective code in the target language. While a piece of code can be optimal in the source language, the target language might have a more efficient formulation for describing the same action than the direct translation produces. The optimizer locates code which can be optimized and replaces the code with the more efficient model.

\end{itemize}
